<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>获取当前网络ip和城市</title>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
	</head>
<style>
	h3{
		word-wrap : break-word;
	}
</style>
	<body>
		<h3 class="url">本地url</h3>
		<hr />
		<h3 class="dks">端口</h3>
		<hr />
		<h3 class="agreement">协议</h3>
		<hr />
		<h3 class="path">路径</h3>
		<hr />
		<h3 class="bdip">本地ip</h3>
		<hr />
		<h3 id="wlip">网络ip</h3>
<script type="text/javascript">
	
    console.log("URL地址=="+window.location.href);//URL地址=
    console.log("主机名="+window.location.hostname);//ip=192.168.1.168;127.0.0.1
    console.log("端口="+window.location.port);//端口8020
    console.log("主机+端口="+location.host);//主机+端口=127.0.0.1:8020;192.168.1.168:8020
    console.log("协议="+location.protocol);//协议=http:
    console.log("路径="+location.pathname);//路径=/test/a.html
	
	
//本地url
	$(".url").html("URL地址："+window.location.href);
//端口
	$(".dks").html("端口："+window.location.port)
//协议
	$(".agreement").html("协议："+location.protocol)
//路径
	$(".path").html("路径：<br />"+location.pathname)
//	引入搜狐接口：获取当前网络ip和城市（适用于移动端）
	var wlip=document.querySelector("#wlip");
	wlip.innerHTML="网络ip："+returnCitySN['cip']+"<br />地址："+returnCitySN['cname'];
//本地ip获取，不需要引入插件
	function getUserIP(onNewIP) {
		var myPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
		var pc = new myPeerConnection({
				iceServers: []
			}),
			noop = function() {},
			localIPs = {},
			ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,
			key;
		function iterateIP(ip) {
			if(!localIPs[ip]) onNewIP(ip);
			localIPs[ip] = true;
		}
		pc.createDataChannel("");
		pc.createOffer().then(function(sdp) {
			sdp.sdp.split('\n').forEach(function(line) {
				if(line.indexOf('candidate') < 0) return;
				line.match(ipRegex).forEach(iterateIP);
			});
			pc.setLocalDescription(sdp, noop, noop);
		}).catch(function(reason) {});
		pc.onicecandidate = function(ice) {
			if(!ice || !ice.candidate || !ice.candidate.candidate || !ice.candidate.candidate.match(ipRegex)) return;
			ice.candidate.candidate.match(ipRegex).forEach(iterateIP);
		};
	}
	getUserIP(function(ip) {
		var bdip=document.querySelectorAll(".bdip")[0];
		bdip.innerHTML="本地ip："+ip;
	});
</script>
	</body>
</html>
